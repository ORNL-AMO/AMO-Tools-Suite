language: cpp

os:
  - linux
  addons:
    apt:
      sources:
        - ubuntu-toolchain-r-test
      packages:
        - g++-7
  env:
    - MATRIX_EVAL="CC=gcc-7 && CXX=g++-7"
  dist: bionic
  - osx

compiler:
  - gcc
#  - clang

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
      brew update;
      brew install doxygen;
      
    else
      - eval "${MATRIX_EVAL}"
      sudo apt-get update;
      sudo apt-get install doxygen;
      curl -sL https://deb.nodesource.com/setup_10.x | sudo -E bash -;
      sudo apt-get install -y nodejs;
    fi

install: travis_retry npm install

script:
  - cmake ./
  - make
  - ./bin/amo_tools_suite_tests
  - npm install
  - npm run test
  - doxygen Doxyfile.in
