#language: cpp
language: node_js
node_js:
  - '12.8.0'
  
compiler:
  - gcc
  #- clang
  
matrix:
  include:
    - name: "Linux Build"
      os: linux
    
    - name: "Mac Build"
      os: osx
      
    - name: "Windows Build"
      os: windows

before_install:
  - |
    if [[ $TRAVIS_OS_NAME == "linux" ]]; then
      sudo apt-get update
      sudo apt-get install -y make
      sudo apt-get install -y doxygen
    fi
  - |
    if [[ $TRAVIS_OS_NAME == "windows" ]]; then
      choco install make --yes
      choco install doxygen.install --yes
    fi
  - |
    if [[ $TRAVIS_OS_NAME == "osx" ]]; then
      bew update
      brew install make
      brew install doxygen
    fi
  
  - node --version
  #- doxygen --version

install:
  - travis_retry npm install
  #- node-gyp rebuild

script:
  - if: branch = "master"
  - ls -a
  - cmake -D BUILD_TESTING:BOOL=ON -D BUILD_PACKAGE:BOOL=OFF --config Debug ./
  - cmake --build .
  - ls -a
  - |
    if [[ $TRAVIS_OS_NAME == "windows" ]]; then
      ./Debug/amo_tools_suite_tests
    else
      ./bin/amo_tools_suite_tests
    fi
  - npm run test
  - npm run at
  - |
    if [[ $TRAVIS_OS_NAME == "windows" ]]; then
      echo "Skipping Doxygen"
    else
      doxygen Doxyfile.in
    fi
