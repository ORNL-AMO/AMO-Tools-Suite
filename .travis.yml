#language: cpp
language: node_js
node_js:
  - '12.8.0'

os:
  #- linux
  #- osx
  - windows

compiler:
  - gcc
#  - clang

before_install:
  - |
    if [[ $TRAVIS_OS_NAME == "linux" ]]; then
      sudo apt-get update
      sudo apt-get install -y make
      sudo apt-get install -y doxygen
    fi
  - |
    if [[ $TRAVIS_OS_NAME == "windows" ]]; then
      choco install -y make
      choco install -y doxygen
    fi
  - |
    if [[ $TRAVIS_OS_NAME == "osx" ]]; then
      bew update
      brew install -y make
      brew install -y doxygen
    fi
  
  - node --version
  - doxygen --version

install: travis_retry npm install

script:
  - ls -a
  - cmake -D BUILD_TESTING:BOOL=ON -D BUILD_PACKAGE:BOOL=OFF --config Debug ./
  - cmake --build .
  - ls -a
  - |
    if [[ $TRAVIS_OS_NAME == "windows" ]]; then
      ./Debug/amo_tools_suite_tests
    else
      ./bin/amo_tools_suite_tests
    fi
  - npm install
  #- node-gyp rebuild
  - npm run test
  - npm run at
  - |
    if [[ $TRAVIS_OS_NAME == "windows" ]]; then
      echo "Skipping Doxygen"
    else
      - doxygen Doxyfile.in
    fi
  #- node --version
  #- cmake ./
  #- make
  #- ./bin/amo_tools_suite_tests
  #- npm install
  #- npm run test
  #- npm run at
  #- doxygen Doxyfile.in
